# 录播
## 视频录制
1. 创建channel后调用录制接口
2. 录制格式MP4
3. 切片时长可配置
4. 直播结束(finished)以后从网易获取直播视频片段，并记录

## 回放入口
1. 辅导班详情页课程安排点击进入回放观看
2. 辅导班直播页课程安排点击进入回放观看
3. 回放页面选择回放列表中的课程观看对应回放

## 回放列表
1. 已直播结束(finished)的课程出现在回放列表中
2. 点击列表项观看对应视频
3. 未结束的课程不显示
4. 达到观看限制的回放灰色不可点
5. 鼠标悬浮显示剩余次数

## 回放观看
1. 同一节课的多个片段顺序播放
2. 还没有结束的课程提示视频不存在
3. 已经达到观看限制的课程显示对应提示
4. 显示本人观看次数
5. 显示总回放次数(待定)

## 观看限制
1. 当天第一次观看记录观看记录
2. 当观看记录数量大于等于数量限制不能观看
3. 数量限制可以配置

## 视频同步
1. 白板视频建立时间轴
2. 摄像头视频根据开始结束时间计算在时间轴上的位置

## 聊天弹幕
1. 聊天内容显示直播时间段内的聊天记录
2. 显示消息发送时间
3. 显示消息在视频时间轴上的时间
4. 弹幕根据视频时间轴进行显示

## 视频剪辑功能(调研可行性)
1. 提供视频在线剪辑功能
2. 剪辑后保存视频
3. 剪辑后计算聊天时间轴

## 安全性
1. 隐藏视频观看地址防止下载
2. 防止视频盗链

## 接口规范
### 辅导班详情
课程信息增加回放信息字段

```
playable: Boolean # 是否支持回放
total_play_times: Integer # 总播放次数
user_playable: Boolean # 用户是否可播放 false表示已经超过播放限制
user_play_times: Integer # 用户播放次数

```

### 回放列表接口

```bash
GET /api/v1/courses/:id/replays
{
  id: 1,
  lessons: [
    {
      id: 1,
      playable: true,
      total_play_times: 100,
      user_playable: true,
      user_play_times: 5
    },
    {
      id: 2,
      playable: true,
      ..
    },
    {
      id: 3,
      playable: true,
      ..
    },
    {
      id: 4,
      playable: false,
      ..
    }
  ]
}
```

### 回放接口
```bash
GET /api/v1/lessons/:id/replay
{
  id: 1, # 课程ID
  total_play_times: 10, # 总播放次数
  user_play_times: 3, # 用户观看次数
  duration: 100, # 总视频时长
  replays: [
    {
      id: 1,
      duration: 30, # 片段时长
      format: 'mp4', # 视频格式
      url: 'https://qatime.cn/xxxx.mp4', '观看地址'
    }
  ]
}
```

## 第一阶段开发
1. 视频录制
2. 回放列表
3. 回放入口
4. 观看回放

## 后续开发
1. 回放限制
2. 摄像头视频显示并同步
3. 聊天记录显示
4. 聊天弹幕同步
5. 视频剪辑